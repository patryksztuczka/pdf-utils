# Agent Guidelines for pdf-util

This document provides instructions and conventions for AI agents operating within the `pdf-util` repository.

## 1. Environment & Commands

### Package Management

- Use `bun` for package management.
- `package.json` contains the project dependencies and scripts.

### Build & Lint

- **Build:** `bun run build`
  - Runs TypeScript compiler (`tsc -b`) and Vite build.
- **Lint:** `bun run lint`
  - Uses ESLint with configuration in `eslint.config.js`.
  - Includes `react-hooks` and `react-refresh` plugins.
- **Type Check:** `bunx tsc -b` (or via build script).

### Testing

- **Current Status:** No testing framework (Vitest/Jest) is currently installed or configured.
- **Action:** Do not attempt to run tests unless you install and configure a test runner first. If adding tests, prefer **Vitest** for Vite compatibility.

### Development

- **Start Server:** `bun run dev` (starts Vite dev server).

## 2. Code Style & Architecture

### Directory Structure

- `src/components/`: Feature-specific React components.
- `src/components/ui/`: Reusable UI components (shadcn/ui style).
- `src/data-access-layer/`: API interaction logic (fetch wrappers).
- `src/schemas/`: Zod schemas for data validation.
- `src/lib/`: Utility functions (e.g., `utils.ts`).
- `src/hooks/`: Custom React hooks.

### Components

- **Syntax:** Use `function` keyword for components (e.g., `export function MyComponent() {}`). Avoid `const MyComponent = () => {}`.
- **Exports:** Use **named exports** for components.
- **Props:** Define prop interfaces explicitly (e.g., `interface MyComponentProps {}`).
- **Hooks:** Use React hooks (`useState`, `useEffect`, `useRef`) at the top level of components.

### Styling

- **Framework:** **Tailwind CSS v4**.
- **Class Merging:** ALWAYS use the `cn(...)` utility from `@/lib/utils` when conditionally applying classes or allowing overrides.
  ```tsx
  import { cn } from "@/lib/utils";
  <div className={cn("bg-red-500", className)} />;
  ```
- **Conventions:** Use kebab-case for CSS classes (standard Tailwind).

### Data Fetching & State

- **Server State:** Use **TanStack React Query** (`useQuery`, `useMutation`) for server data.
- **API Layer:** Isolate `fetch` calls in `src/data-access-layer/`.
- **Validation:** Use **Zod** schemas to validate API responses in the data access layer before returning data to components.
  ```ts
  // Example pattern in data-access-layer
  const rawData = await response.json();
  return MessageSchema.parse(rawData);
  ```

### TypeScript & Types

- **Strict Mode:** TypeScript is enabled with strict mode.
- **Imports:** Use absolute imports with the `@/` alias (resolves to `./src/`).
  - Example: `import { Button } from "@/components/ui/button";`
- **Type Definitions:** Prefer `interface` for object shapes and `type` for unions/intersections.

### Naming Conventions

- **Files:** `kebab-case.tsx` or `kebab-case.ts`.
- **Components:** `PascalCase`.
- **Functions/Variables:** `camelCase`.
- **Constants:** `UPPER_SNAKE_CASE` (mostly for configuration constants).

## 3. Workflow & Error Handling

### Error Handling

- Handle API errors gracefully in the data access layer (throw specific errors).
- UI components should handle loading and error states (often via React Query's `isLoading` / `isError`).
- Use `try...catch` blocks for async operations or streams.

### Streaming

- The application supports streaming responses (e.g., `getCompletion` generator in `messages.ts`).
- Ensure `TextDecoder` is used for processing stream chunks.

### Dependencies

- Do not add new heavy libraries without checking existing ones.
- Key libs: `lucide-react` (icons), `zod` (validation), `radix-ui` (primitives).

---

_Generated by opencode_
